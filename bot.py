#- telebo –≥–ª–∞–≤–Ω–∞—è –±–∏–±–ª–∏–æ—Ç–µ–∫–∞ –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å Telegram
import telebot
#types - –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è  –∫–ª–∞–≤–∏–∞—Ç—É—Ä –∏ –∫–Ω–æ–ø–æ–∫
from telebot import types
# os - –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –æ–ø–µ—Ä–∞—Ü–∏–æ–Ω–Ω–æ–π —Å–∏—Å—Ç–µ–º–æ–π (—á—Ç–µ–Ω–∏–µ —Ñ–∞–π–ª–æ–≤)
import os
#–¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏ —Å–µ–∫—Ä–µ—Ç–Ω–æ–≥–æ —Ç–æ–∫–µ–Ω–∞ –±–æ—Ç–∞ –∏–∑ —Ñ–∞–π–ª–∞ .env
from dotenv import load_dotenv
print("üöÄ –ó–ê–ü–£–°–ö –ë–û–¢–ê –î–õ–Ø –ü–û–î–ë–û–†–ê –í–£–ó–û–í")

# –ó–∞–≥—Ä—É–∂–∞–µ–º —Å–µ–∫—Ä–µ—Ç–Ω—ã–π —Ç–æ–∫–µ–Ω
load_dotenv()
BOT_TOKEN = os.getenv("BOT_TOKEN")

if not BOT_TOKEN:
    print("‚ùå –û–®–ò–ë–ö–ê: –¢–æ–∫–µ–Ω –Ω–µ –Ω–∞–π–¥–µ–Ω!")
    exit()

print(f"‚úÖ –¢–æ–∫–µ–Ω –∑–∞–≥—Ä—É–∂–µ–Ω: {BOT_TOKEN[:10]}...")

# –°–æ–∑–¥–∞—ë–º –±–æ—Ç–∞, –ø–µ—Ä–µ–¥–∞–≤–∞—è –µ–º—É —Ç–æ–∫–µ–Ω
bot = telebot.TeleBot(BOT_TOKEN)
#–°–ª–æ–≤–∞—Ä—å –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö –∫–∞–∂–¥–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
# –ö–ª—é—á - ID –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è, –∑–Ω–∞—á–µ–Ω–∏–µ - —Å–ª–æ–≤–∞—Ä—å —Å –µ–≥–æ –¥–∞–Ω–Ω—ã–º–∏
user_data = {}

# –ë–ê–ó–ê –í–£–ó–û–í
#–ö–∞–∂–¥—ã–π –≤—É–∑ ‚Äî —ç—Ç–æ —Å–ª–æ–≤–∞—Ä—å —Å –∫–ª—é—á–∞–º–∏:
'''name ‚Äî –Ω–∞–∑–≤–∞–Ω–∏–µ
interests ‚Äî –ø–æ–¥—Ö–æ–¥—è—â–∏–µ –∏–Ω—Ç–µ—Ä–µ—Å—ã
¬∑ subjects ‚Äî –Ω—É–∂–Ω—ã–µ –ø—Ä–µ–¥–º–µ—Ç—ã –ï–ì–≠
¬∑ min_score ‚Äî –º–∏–Ω–∏–º–∞–ª—å–Ω—ã–π –±–∞–ª–ª
¬∑ description ‚Äî –æ–ø–∏—Å–∞–Ω–∏–µ'''

UNIVERSITIES = [
    {
        "name": "–ú–ì–£ –∏–º. –õ–æ–º–æ–Ω–æ—Å–æ–≤–∞",
        "interests": ["üî¨ –ù–∞—É–∫–∞", "üè• –ú–µ–¥–∏—Ü–∏–Ω–∞"],
        "subjects": ["üìê –ú–∞—Ç–µ–º–∞—Ç–∏–∫–∞", "üß™ –•–∏–º–∏—è", "‚öõÔ∏è –§–∏–∑–∏–∫–∞"],
        "min_score": 330,
        "description": "–í–µ–¥—É—â–∏–π –≤—É–∑ —Å—Ç—Ä–∞–Ω—ã, —Å–∏–ª—å–Ω—ã–µ –µ—Å—Ç–µ—Å—Ç–≤–µ–Ω–Ω—ã–µ –Ω–∞—É–∫–∏"
    },
    {
        "name": "–ú–§–¢–ò",
        "interests": ["üíª IT", "‚öõÔ∏è –§–∏–∑–∏–∫–∞"],
        "subjects": ["üìê –ú–∞—Ç–µ–º–∞—Ç–∏–∫–∞", "‚öõÔ∏è –§–∏–∑–∏–∫–∞", "üíª –ò–Ω—Ñ–æ—Ä–º–∞—Ç–∏–∫–∞"],
        "min_score": 310,
        "description": "–§–∏–∑—Ç–µ—Ö, —Å–∏–ª—å–Ω–∞—è —Ñ–∏–∑–∏–∫–æ-–º–∞—Ç–µ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –ø–æ–¥–≥–æ—Ç–æ–≤–∫–∞"
    },
    {
        "name": "–í–®–≠",
        "interests": ["üìä –≠–∫–æ–Ω–æ–º–∏–∫–∞", "üíª IT"],
        "subjects": ["üìê –ú–∞—Ç–µ–º–∞—Ç–∏–∫–∞", "üåç –û–±—â–µ—Å—Ç–≤–æ–∑–Ω–∞–Ω–∏–µ"],
        "min_score": 280,
        "description": "–°–æ–≤—Ä–µ–º–µ–Ω–Ω—ã–π –≤—É–∑ —Å —ç–∫–æ–Ω–æ–º–∏—á–µ—Å–∫–∏–º–∏ –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏—è–º–∏"
    },
    {
        "name": "–ú–ò–§–ò",
        "interests": ["üìê –ò–Ω–∂–µ–Ω–µ—Ä–∏—è", "üíª IT"],
        "subjects": ["üìê –ú–∞—Ç–µ–º–∞—Ç–∏–∫–∞", "‚öõÔ∏è –§–∏–∑–∏–∫–∞"],
        "min_score": 260,
        "description": "–Ø–¥–µ—Ä–Ω—ã–µ —Ç–µ—Ö–Ω–æ–ª–æ–≥–∏–∏, –∏–Ω–∂–µ–Ω–µ—Ä–∏—è, IT"
    }
]

#  –°–ø–∏—Å–æ–∫ —Å–æ —Å–ª–æ–≤–∞—Ä–µ–º –ü–†–û–§–¢–ï–°–¢. –ó–∞ –æ—Ç–≤–µ—Ç –Ω–∞—á–∏—Å–ª—è—Ç—Å—è 2 –±–∞–ª–ª–∞, –∫–æ—Ç–æ—Ä—ã–π —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –≤ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏
prof_test_questions = [
    {
        "question": "1. –ß—Ç–æ —Ç–µ–±–µ –±–æ–ª—å—à–µ –Ω—Ä–∞–≤–∏—Ç—Å—è?",
        "options": ["üîç –†–∞–∑–±–∏—Ä–∞—Ç—å—Å—è –≤ –ø—Ä–∏—á–∏–Ω–∞—Ö", "‚öôÔ∏è –°–æ–∑–¥–∞–≤–∞—Ç—å —Å–≤–æ–∏–º–∏ —Ä—É–∫–∞–º–∏",
                    "üí¨ –û–±—â–∞—Ç—å—Å—è –∏ –ø–æ–º–æ–≥–∞—Ç—å", "üìä –ê–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å –¥–∞–Ω–Ω—ã–µ"],
        "scores": [{"üî¨": 2}, {"üîß": 2}, {"üë•": 2}, {"üìà": 2}]
    },
    {
        "question": "2. –ö–∞–∫–æ–π —à–∫–æ–ª—å–Ω—ã–π –ø—Ä–µ–¥–º–µ—Ç –∏–Ω—Ç–µ—Ä–µ—Å–Ω–µ–µ?",
        "options": ["üß™ –•–∏–º–∏—è/–ë–∏–æ–ª–æ–≥–∏—è", "‚öõÔ∏è –§–∏–∑–∏–∫–∞/–ò–Ω—Ñ–æ—Ä–º–∞—Ç–∏–∫–∞",
                    "üèõÔ∏è –ò—Å—Ç–æ—Ä–∏—è/–û–±—â–µ—Å—Ç–≤–æ", "üìê –ú–∞—Ç–µ–º–∞—Ç–∏–∫–∞"],
        "scores": [{"üî¨": 3}, {"üîß": 3}, {"üë•": 3}, {"üìà": 3}]
    }
]

#–°–ø–∏—Å–æ–∫ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤. –ì–¥–µ –±—É–¥–µ—Ç –±–æ–ª—å—à–µ –æ—á–∫–æ–≤, —Ç–æ—Ç –≤–∞—Ä–∏–∞–Ω—Ç –∏ –ø–æ–∫–∞–∂—É—Ç
prof_results = {
    "üî¨": {
        "name": "–ï—Å—Ç–µ—Å—Ç–≤–µ–Ω–Ω–æ-–Ω–∞—É—á–Ω—ã–π –ø—Ä–æ—Ñ–∏–ª—å",
        "interests": ["üî¨ –ï—Å—Ç–µ—Å—Ç–≤–µ–Ω–Ω—ã–µ –Ω–∞—É–∫–∏", "üè• –ú–µ–¥–∏—Ü–∏–Ω–∞"]
    },
    "üîß": {
        "name": "–¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–π –ø—Ä–æ—Ñ–∏–ª—å",
        "interests": ["üíª IT –∏ –ø—Ä–æ–≥—Ä–∞–º–º–∏—Ä–æ–≤–∞–Ω–∏–µ", "üìê –ò–Ω–∂–µ–Ω–µ—Ä–∏—è"]
    },
    "üë•": {
        "name": "–°–æ—Ü–∏–∞–ª—å–Ω–æ-–≥—É–º–∞–Ω–∏—Ç–∞—Ä–Ω—ã–π –ø—Ä–æ—Ñ–∏–ª—å",
        "interests": ["‚öñÔ∏è –Æ—Ä–∏—Å–ø—Ä—É–¥–µ–Ω—Ü–∏—è", "üé® –î–∏–∑–∞–π–Ω –∏ –∏—Å–∫—É—Å—Å—Ç–≤–æ"]
    },
    "üìà": {
        "name": "–≠–∫–æ–Ω–æ–º–∏—á–µ—Å–∫–∏–π –ø—Ä–æ—Ñ–∏–ª—å",
        "interests": ["üìä –≠–∫–æ–Ω–æ–º–∏–∫–∞ –∏ —Ñ–∏–Ω–∞–Ω—Å—ã"]
    }
}


# –§–£–ù–ö–¶–ò–ò –§–ò–õ–¨–¢–†–ê–¶–ò–ò
#–ü–æ–¥–±–æ—Ä –≤—É–∑–æ–≤
def filter_universities(interests, subjects, score):

    """–§–∏–ª—å—Ç—Ä–∞—Ü–∏—è –≤—É–∑–æ–≤"""
    suitable = [] #—Å–ø–∏—Å–æ–∫ –¥–ª—è –ø–æ–¥—Ö–æ–¥—è—â–∏—Ö –≤—É–∑–æ–≤

    for uni in UNIVERSITIES: #–ø—Ä–æ—Ö–æ–¥–∏–º—Å—è –ø–æ –≤—É–∑–∞–º
        # –ü—Ä–æ–≤–µ—Ä—è–µ–º —Å–æ–≤–ø–∞–¥–µ–Ω–∏–µ
        #–µ—Å–ª–∏ —Å–ø–∏—Å–æ–∫ –ø—É—Å—Ç–æ–π —Å –∏–Ω—Ç–µ—Ä–µ—Å–æ–≤ –≤–æ–æ–±—â–µ, —Ç–æ —Ç–æ–∂–µ, —Ç—Ä—É
        interest_ok = any(i in uni["interests"] for i in interests) if interests else True #—Ö–æ—Ç—è –±—ã –æ–¥–∏–Ω –∏–Ω—Ç–µ—Ä–µ—Å –µ—Å—Ç—å?
        subject_ok = any(s in uni["subjects"] for s in subjects) if subjects else True #—Ö–æ—Ç—è –±—ã –æ–¥–∏–Ω –ø—Ä–µ–¥–º–µ—Ç –µ—Å—Ç—å?
        score_ok = score >= uni["min_score"] - 20 if score else True #–ø—Ä–æ–≤–µ—Ä—è–µ–º –±–∞–ª–ª—ã,—Å –∑–∞–ø–∞—Å–æ–º –≤ 20 –±–∞–ª–ª–æ–≤

        if interest_ok and subject_ok and score_ok:#–µ—Å–ª—Ç –≤—Å–µ 3 –ø—Ä–æ–≤–µ—Ä–∫–∏ –ø—Ä–æ—à–ª–∏
            uni_copy = uni.copy()#–∫–æ–ø–∏—Ä—É–µ–º –∏–Ω—Ñ–æ –æ  —É–Ω–∏–≤–µ—Ä—Å–∏—Ç–µ—Ç–µ
            #—Ä–∞—Å—á–∏—Ç—ã–≤–∞–µ–º –ø—Ä–æ—Ü–µ–Ω—Ç —Å–æ–≤–ø–∞–¥–µ–Ω–∏–µ –≤ –≤—É–∑
            if score and uni["min_score"] > 0:#–µ—Å–ª–∏ –±–∞–ª–ª—ã –≤–≤–µ–¥–µ–µ–Ω—ã –∏ –µ—Å—Ç—å –º–∏–Ω –±–∞–ª–ª—ã –≤—É–∑–∞
                #—Å–æ–∑–¥–∞–µ–º –≤ —Å–ª–æ–≤–∞—Ä–µ –≤—É–∑–∞ –Ω–æ–≤—ã–π –∫–ª—é—á match –¥–ª—è –ø—Ä–æ—Ü–µ–Ω—Ç–∞
                #–≤—ã—á–∏—Å–ª—è–µ–º –ø—Ä–æ—Ü–µ–Ω—Ç=–±–∞–ª–ª—ã –ø–æ–ª—å–∑/–º–∏–Ω –±—ã–ª–ª–∞, –Ω–æ –µ—Å–ª–∏ >95,—Ç–æ –ø–∏—à–µ–º 95,—á—Ç–æ–±—ã –Ω–µ –±—ã–ª–æ 100%
                uni_copy["match"] = min(95, int((score / uni["min_score"]) * 100))
            else:
                uni_copy["match"] = 70 #–µ—Å–ª–∏ –±—ã–ª–ª–æ–≤ –Ω–µ—Ç, —Ç–æ –ø–∏—à–µ–º 70%
            suitable.append(uni_copy) #–¥–æ–±–∞–≤–ª—è–µ–º –≤ —Å–ø–∏—Å–æ–∫ –∏–Ω—Ñ–æ—Ä –∑–∞ –≤—É–∑

    suitable.sort(key=lambda x: x["match"], reverse=True) #—Å–æ—Ä—Ç–∏—Ä—É–µ–º —Å–ø–∏—Å–æ–∫ —Å –≤—É–∑–∞–º–∏ –ø–æ–¥—Ö–æ–¥ –ø–æ –ø—Ä–æ—Ü–µ–Ω—Ç—É –ø–æ —É–±—ã–≤–∞–Ω–∏—é
    return suitable[:3] #–≤—ã–≤–æ–¥–∏–º —Ç—Ä–∏ —Å–∞–º—ã—Ö –ø–æ–¥—Ö–æ–¥—è—â–∏—Ö –≤—É–∑–æ–≤


#  –ì–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é —Å –∫–Ω–æ–ø–∫–∞–º–∏ –≤ –±–æ—Ç–µ
#–°–æ–∑–¥–∞–µ–º 4 –∫–Ω–æ–ø–∫–∏, –¥–≤–µ —Å–ª–µ–≤–∞ –∏ –¥–≤–µ —Å–ø—Ä–∞–≤–∞
#types.ReplyKeyboardMarkup - —Å–æ–∑–¥–∞—Ç—å –∫–ª–∞–≤–∏–∞—Ç—É—Ä–∞ —Å –∫–Ω–æ–ø–∫–∞–º–∏
#resize_keyboard=True - –ø–æ–¥–æ–≥–Ω–∞—Ç—å —Ä–∞–∑–º–µ—Ä –∫–Ω–æ–ø–æ–∫ –ø–æ–¥ —ç–∫—Ä–∞–Ω —Ç–µ–ª–µ—Ñ–æ–Ω–∞
#row_width=2 - —Ä–∞—Å–ø–æ–ª–æ–∂–∏—Ç—å –∫–Ω–æ–ø–∫–∏ –ø–æ 2 —Ä—è–¥–∞
def main_menu():
    markup = types.ReplyKeyboardMarkup(resize_keyboard=True, row_width=2)
    #–¥–æ–±–∞–≤–ª—è–µ–º —Å–∞–º–∏ –∫–Ω–æ–ø–∫–∏
    markup.add(
        types.KeyboardButton("üéì –ù–∞—á–∞—Ç—å –ø–æ–¥–±–æ—Ä –≤—É–∑–∞"),
        types.KeyboardButton("üß© –ü—Ä–æ–π—Ç–∏ –ø—Ä–æ—Ñ—Ç–µ—Å—Ç"),
        types.KeyboardButton("‚ÑπÔ∏è –û –±–æ—Ç–µ"),
        types.KeyboardButton("üìä –ú–æ–∏ –¥–∞–Ω–Ω—ã–µ")
    )
    return markup


#—Å–æ–∑–¥–∞–µ–º –∫–ª–∞–≤–∏–∞—Ç—É—Ä—É —Å –∫–Ω–æ–ø–∫–∞–º–∏ –∏–Ω—Ç–µ—Ä–µ—Å–æ–≤
def interests_keyboard():
    markup = types.ReplyKeyboardMarkup(resize_keyboard=True, row_width=2)
    buttons = ["üíª IT", "üè• –ú–µ–¥–∏—Ü–∏–Ω–∞", "üìê –ò–Ω–∂–µ–Ω–µ—Ä–∏—è", "üìä –≠–∫–æ–Ω–æ–º–∏–∫–∞",
               "üé® –î–∏–∑–∞–π–Ω", "‚öñÔ∏è –ü—Ä–∞–≤–æ", "üî¨ –ù–∞—É–∫–∞", "‚û°Ô∏è –î–∞–ª–µ–µ"]
    markup.add(*buttons)
    return markup

#—Å–æ–∑–¥–∞–µ–º –∫–ª–∞–≤–∏–∞—Ç—É—Ä—É —Å –∫–Ω–æ–ø–∫–∞–º–∏ –ø—Ä–µ–¥–º–µ—Ç–æ–≤
def subjects_keyboard():
    markup = types.ReplyKeyboardMarkup(resize_keyboard=True, row_width=3)
    buttons = ["üìê –ú–∞—Ç–µ–º–∞—Ç–∏–∫–∞", "üìö –†—É—Å—Å–∫–∏–π", "üíª –ò–Ω—Ñ–æ—Ä–º–∞—Ç–∏–∫–∞",
               "üåç –û–±—â–µ—Å—Ç–≤–æ–∑–Ω–∞–Ω–∏–µ", "üß™ –•–∏–º–∏—è", "‚öõÔ∏è –§–∏–∑–∏–∫–∞",
               "üåé –ë–∏–æ–ª–æ–≥–∏—è", "üèõÔ∏è –ò—Å—Ç–æ—Ä–∏—è", "‚û°Ô∏è –î–∞–ª–µ–µ"]
    markup.add(*buttons)
    return markup


#  –û–°–ù–û–í–ù–´–ï –û–ë–†–ê–ë–û–¢–ß–ò–ö–ò
#–°–∞–º–æ–µ –Ω–∞—á–∞–ª–æ —Ä–∞–±–æ—Ç—ã –±–æ—Ç–∞ - start
@bot.message_handler(commands=['start']) #–µ—Å–ª–∏ –≤–≤–µ–¥—É—Ç –∫–æ–º–∞–Ω–¥—É start,—Ç–æ –≤—ã–∑–æ–≤–µ—Ç—Å—è —Ñ—É–Ω–∫—Ü–∏—è send_welcome
def send_welcome(message):
    user_id = message.from_user.id # —Å–æ—Ö—Ä–∞–Ω—è–µ–º —É–Ω–∏–∫–∞–ª –Ω–æ–º–µ—Ä –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –≤ —Ç–µ–ª–µ–≥—Ä–∞–º
    #—Å–æ–∑–¥–∞–µ–º –∞–Ω–∫–µ—Ç—É –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –≤ user_data
    user_data[user_id] = {
        "step": "start",
        "interests": [],
        "subjects": [],
        "score": None
    }

    #–ü—Ä–∏–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω—ã–π —Ç–µ–∫—Å—Ç, * —á—Ç–æ–±—ã —Ç–µ–∫—Å—Ç –±—ã–ª –∂–∏—Ä–Ω—ã–π
    text = """
    üëã *–ü—Ä–∏–≤–µ—Ç, –∞–±–∏—Ç—É—Ä–∏–µ–Ω—Ç!*

    –Ø –ø–æ–º–æ–≥—É –≤—ã–±—Ä–∞—Ç—å –≤—É–∑ –≤ –ú–æ—Å–∫–≤–µ:

    üéØ *–ü—Ä–æ—Ñ—Ç–µ—Å—Ç* - –µ—Å–ª–∏ –Ω–µ –∑–Ω–∞–µ—à—å, –∫—É–¥–∞ –ø–æ—Å—Ç—É–ø–∞—Ç—å
    üéì *–ü—Ä—è–º–æ–π –ø–æ–¥–±–æ—Ä* - –µ—Å–ª–∏ –µ—Å—Ç—å –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–µ –∏–Ω—Ç–µ—Ä–µ—Å—ã

    –í—ã–±–µ—Ä–∏ –¥–µ–π—Å—Ç–≤–∏–µ:
        """
    #–æ—Ç–ø—Ä–∞–≤–ª—è–µ–º —Å–æ–æ–±—â–µ–Ω–∏–µ
    #message.chat.id - –≤ —Ç–æ—Ç –∂–µ —á–∞—Ç
    #text - —á—Ç–æ –æ—Ç–ø—Ä–∞–≤–ª—è–µ–º, –≤—ã—à–µ –Ω–∞–ø–∏—Å–∞–ª–∏
    #parse_mode = "Markdown" - —á—Ç–æ–±—ã * –±—ã–ª–∞ –∫–∞–∫ –∂–∏—Ä–Ω—ã–π —Ç–µ–∫—Å—Ç
    #reply_markup=main_menu() - –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç –∫–ª–∞–≤–∏–∞—Ç—É—Ä—É —Å 4 –∫–Ω–æ–ø–∫–∞–º–∏, —á—Ç–æ —Ä–∞–Ω–µ–µ —Å–æ–∑–¥–∞–ª–∏

    bot.send_message(message.chat.id, text, parse_mode="Markdown", reply_markup=main_menu())
    print(f"üë§ –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å {user_id} –∑–∞–ø—É—â–µ–Ω") #–≤—ã–≤–æ–¥ –≤ –∫–æ–Ω—Å–æ–ª–µ

#–¥–µ–∫–æ—Ä–∞—Ç–æ—Ä —Å —Ñ–∏–ª—å—Ç—Ä–æ–º.
@bot.message_handler(func=lambda m: m.text == "üéì –ù–∞—á–∞—Ç—å –ø–æ–¥–±–æ—Ä –≤—É–∑–∞") #–≤—ã–∑—ã–≤–∞–µ–º —Ñ—É–Ω–∫—Ü–∏—é, –∫–æ–≥–¥–∞ –Ω–∞–∂–∞—Ç–∞ –∫–Ω–æ–ø–∫–∞
def start_selection(message):
    user_id = message.from_user.id #–ø–æ–ª—É—á–∞–µ–º id –ø–æ–ª–∑—å–≤–∞—Ç–µ–ª—è
    user_data[user_id]["step"] = "select_interests" #–±–æ—Ç –∑–∞–ø–æ–º–∏–Ω–∞–µ—Ç —à–∞–≥ —Ç–µ–∫—É—â–∏–π,—á—Ç–æ–±—ã –∑–Ω–∞—Ç—å, —á—Ç–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –±—É–ª–µ—Ç –¥–µ–ª–∞—Ç—å
    bot.send_message(message.chat.id,
                     "üéØ *–í—ã–±–µ—Ä–∏ —Å—Ñ–µ—Ä—ã –∏–Ω—Ç–µ—Ä–µ—Å–æ–≤:*\n(–º–æ–∂–Ω–æ –Ω–µ—Å–∫–æ–ª—å–∫–æ, –∑–∞—Ç–µ–º ¬´‚û°Ô∏è –î–∞–ª–µ–µ¬ª)",
                     parse_mode="Markdown", reply_markup=interests_keyboard())


@bot.message_handler(func=lambda m: m.text == "üß© –ü—Ä–æ–π—Ç–∏ –ø—Ä–æ—Ñ—Ç–µ—Å—Ç")
def start_test(message):
    user_id = message.from_user.id
    user_data[user_id] = {
        "step": "prof_test",
        "test_q": 0,
        "test_scores": {"üî¨": 0, "üîß": 0, "üë•": 0, "üìà": 0}
    }

    q = prof_test_questions[0]
    markup = types.ReplyKeyboardMarkup(resize_keyboard=True, row_width=2)
    for opt in q["options"]:
        markup.add(types.KeyboardButton(opt))

    bot.send_message(message.chat.id,
                     f"üß© *–ü—Ä–æ—Ñ—Ç–µ—Å—Ç (2 –≤–æ–ø—Ä–æ—Å–∞)*\n\n{q['question']}",
                     parse_mode="Markdown", reply_markup=markup)


@bot.message_handler(func=lambda m: m.text in [
    "üîç –†–∞–∑–±–∏—Ä–∞—Ç—å—Å—è –≤ –ø—Ä–∏—á–∏–Ω–∞—Ö", "‚öôÔ∏è –°–æ–∑–¥–∞–≤–∞—Ç—å —Å–≤–æ–∏–º–∏ —Ä—É–∫–∞–º–∏",
    "üí¨ –û–±—â–∞—Ç—å—Å—è –∏ –ø–æ–º–æ–≥–∞—Ç—å", "üìä –ê–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å –¥–∞–Ω–Ω—ã–µ",
    "üß™ –•–∏–º–∏—è/–ë–∏–æ–ª–æ–≥–∏—è", "‚öõÔ∏è –§–∏–∑–∏–∫–∞/–ò–Ω—Ñ–æ—Ä–º–∞—Ç–∏–∫–∞",
    "üèõÔ∏è –ò—Å—Ç–æ—Ä–∏—è/–û–±—â–µ—Å—Ç–≤–æ", "üìê –ú–∞—Ç–µ–º–∞—Ç–∏–∫–∞"
])

#—Ñ—É–Ω–∫—Ü–∏—è –æ—Ç–≤–µ—Ç–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –≤ –ø—Ä–æ—Ñ —Ç–µ—Å—Ç–µ
def handle_test_answer(message):
    user_id = message.from_user.id #–ø–æ–ª—É—á–∞–µ—Ç id –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
    #–ø—Ä–æ–≤–µ—Ä—è–µ–º –µ—Å—Ç—å –ª–∏ —Ç–∞–∫–æ–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∏ –ø—Ä–æ—Ö–æ–¥–∏—Ç –ª–∏ –æ–Ω –ø—Ä–æ—Ñ —Ç–µ—Å—Ç
    if user_id not in user_data or user_data[user_id].get("step") != "prof_test":
        return # –≤—ã—Ö–æ–¥–∏–º –µ—Å–ª–∏ –µ–≥–æ –Ω–µ—Ç

    q_num = user_data[user_id]["test_q"]#—Å–æ—Ö—Ä–∞–Ω—è–µ–º –Ω–æ–º–µ—Ä —Ç–µ–∫—É—â–µ–≥–æ –≤–æ–ø—Ä–æ—Å–∞
    q = prof_test_questions[q_num]#—Å–æ—Ö—Ä–∞–Ω—è–µ–º —Å–∞–º –≤–æ–ø—Ä–æ—Å

    # –ù–∞—Ö–æ–¥–∏–º –≤—ã–±—Ä–∞–Ω–Ω—ã–π –≤–∞—Ä–∏–∞–Ω—Ç
    found = False# –ø–µ—Ä–µ–º–µ–Ω–Ω–∞—è –¥–ª—è —Å–æ–≤–ø–∞–¥–µ–Ω–∏—è –æ—Ç–≤–µ—Ç–∞
    #–ø—Ä–æ—Ö–æ–¥–∏–º –ø–æ –≤—Å–µ–º –≤–∞—Ä–∏–∞–Ω—Ç–æ–º –æ—Ç–≤–µ—Ç–∞
    for i, opt in enumerate(q["options"]):
        if opt == message.text:#–µ—Å–ª–∏ —Ç–µ–∫—Å—Ç —Å–æ–≤–ø–∞–ª
            found = True#–Ω–∞—à–ª–∏ –æ—Ç–≤–µ—Ç
            # –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ–º –±–∞–ª–ª—ã (–∏—Å–ø—Ä–∞–≤–ª–µ–Ω–Ω–∞—è —á–∞—Å—Ç—å)
            score_items = q["scores"][i]#—Å–æ—Ö—Ä–∞–Ω—è–µ–º –æ—á–∫–∏ –¥–ª—è —ç—Ç–æ–≥–æ –æ—Ç–≤–µ—Ç–∞

            # –ü—Ä–æ–≤–µ—Ä—è–µ–º —Å—Ç—Ä—É–∫—Ç—É—Ä—É
            if isinstance(score_items, list):#—ç—Ç–æ —Å–ø–∏—Å–æ–∫?
                # –≠—Ç–æ —Å–ø–∏—Å–æ–∫ —Å–ª–æ–≤–∞—Ä–µ–π —Ç–æ–≥–¥–∞ –ø—Ä–æ—Ö–æ–¥–∏–º—Å—è –ø–æ —Å–ø–∏—Å–∫—É
                for item in score_items:
                    if isinstance(item, dict):#–µ—Å–ª–∏ —ç-—Ç —Å–ø–∏—Å–∫–∞ —Å–ª–æ–≤–∞—Ä—å —Ç–æ–≥–¥–∞ –ø—Ä–æ—Ö–æ–¥–∏–º—Å—è –ø—Ä–æ —ç-–∞–º —Å–ª–æ–≤–æ—Ä—è
                        for prof, points in item.items():
                            user_data[user_id]["test_scores"][prof] += points#–¥–æ–±–∞–≤–ª—è–µ–º –æ—á–∫–∏
                    else:
                        print(f"–ù–µ–æ–∂–∏–¥–∞–Ω–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç: {item}")
            elif isinstance(score_items, dict):
                # –≠—Ç–æ –ø—Ä–æ—Å—Ç–æ —Å–ª–æ–≤–∞—Ä—å
                for prof, points in score_items.items():
                    user_data[user_id]["test_scores"][prof] += points

            break

    if not found:
        return
    #–µ—Å–ª–∏ –≤–∞—Ä–∏–∞–Ω—Ç –≤–≤–µ–¥–µ–Ω, —Ç–æ –ø–µ—Ä–µ—Ö–æ–¥–∏–º –∫ —Å–ª–µ–¥ –≤–æ–ø—Ä–æ—Å—É
    user_data[user_id]["test_q"] += 1

    # –µ—Å–ª–∏ –≤–æ–ø—Ä–æ—Å—ã –µ—â–µ –µ—Å—Ç—å
    if user_data[user_id]["test_q"] < len(prof_test_questions):
        # –°–ª–µ–¥—É—é—â–∏–π –≤–æ–ø—Ä–æ—Å
        next_q = prof_test_questions[user_data[user_id]["test_q"]]
        markup = types.ReplyKeyboardMarkup(resize_keyboard=True, row_width=2) # —Å–æ–∑–¥–∞–µ–º –∫–ª–∞–≤–∏—É—Ç–∞—Ä—É –¥–ª—è —Å–ª–µ–¥ –≤–æ–ø—Ä–æ—Å–∞
        for opt in next_q["options"]:
            markup.add(types.KeyboardButton(opt))#–¥–æ–±–∞–≤–ª—è–µ–º –∫–Ω–æ–ø–∫–∏
        #–æ—Ç–ø—Ä–∞–≤–ª—è–µ–º —Å–ª–µ–¥ –≤–æ–ø—Ä–æ—Å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é
        bot.send_message(message.chat.id,
                         f"üß© –í–æ–ø—Ä–æ—Å {user_data[user_id]['test_q'] + 1}/2\n\n{next_q['question']}",
                         parse_mode="Markdown", reply_markup=markup)
    else:
        # –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã
        scores = user_data[user_id]["test_scores"] #—Å–æ—Ö—Ä–∞–Ω—è–µ–º –≤—Å–µ –æ—á–∫–∏
        main_prof = max(scores, key=scores.get)#–Ω–∞—Ö–æ–¥–∏–º –º–∞–∫—Å –±–∞–ª–ª—ã –ø–æ –∑–Ω–∞—á–µ–Ω–∏—é –≤ —Å–ª–æ–≤–∞—Ä–µ –æ—á–∫–æ–≤
        result = prof_results[main_prof]#—Å–æ—Ö—Ä–∞–Ω—è–µ–º —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–µ–µ –æ–ø–∏—Å–∞–Ω–∏–µ –≤—É–∑–∞

        user_data[user_id]["prof_result"] = result["interests"] # —Å–æ—Ö—Ä–∞–Ω—è–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –≤ –ø—Ä–æ—Ñ–∏–ª—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
        user_data[user_id]["step"] = "test_done"# –º–µ–Ω—è–µ–º –¥–∞–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –Ω–∞ —Ç–µ—Å—Ç –∑–∞–≤–µ—Ä—à–µ–Ω

        text = f"üéØ *–¢–≤–æ–π –ø—Ä–æ—Ñ–∏–ª—å: {result['name']}*\n\n" #—Å–æ—Ö—Ä–∞–Ω—è–µ–º —Å–æ–æ–±—â–µ–Ω–∏–µ –≤–≤–æ–¥–Ω–æ–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é
        text += f"üìã –†–µ–∫–æ–º–µ–Ω–¥—É–µ–º—ã–µ —Å—Ñ–µ—Ä—ã:\n"
        #–ø—Ä–æ—Ö–æ–¥–∏–º—Å—è –ø–æ —Ä–µ–∫–æ–º–µ–Ω–¥–æ–≤–∞–Ω–Ω—ã–º –ø—Ä–æ—Ñ–µ—Å—Å–∏—è–º –∏ –¥–æ–±–∞–≤–ª—è–µ–º –ø–æ–¥—Ö–æ–¥—è—â–∏–µ
        for interest in result["interests"]:
            text += f"‚Ä¢ {interest}\n"
        text += "\n–¢–µ–ø–µ—Ä—å –º–æ–∂–µ—à—å –Ω–∞—á–∞—Ç—å –ø–æ–¥–±–æ—Ä –≤—É–∑–∞!"
        # –æ—Ç–ø—Ä–∞–≤–ª—è–µ–º —Å—Ñ–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é
        bot.send_message(message.chat.id, text,
                         parse_mode="Markdown", reply_markup=main_menu())

#–¥–µ–∫–æ—Ä–∞—Ç–æ—Ä –∏–Ω—Ç–µ—Ä–µ—Å–æ–≤
@bot.message_handler(func=lambda m: m.text in ["üíª IT", "üè• –ú–µ–¥–∏—Ü–∏–Ω–∞", "üìê –ò–Ω–∂–µ–Ω–µ—Ä–∏—è",
                                               "üìä –≠–∫–æ–Ω–æ–º–∏–∫–∞", "üé® –î–∏–∑–∞–π–Ω", "‚öñÔ∏è –ü—Ä–∞–≤–æ", "üî¨ –ù–∞—É–∫–∞"])
def handle_interests(message):#–ü–æ–ª—É—á–∞–µ–º ID –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
    user_id = message.from_user.id
    # –ï—Å–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ –≤ –±–∞–∑–µ –ò–õ–ò –Ω–µ –Ω–∞ —ç—Ç–∞–ø–µ –≤—ã–±–æ—Ä–∞ –∏–Ω—Ç–µ—Ä–µ—Å–æ–≤, –≤—ã—Ö–æ–¥–∏–º (return)
    if user_id not in user_data or user_data[user_id].get("step") != "select_interests":
        return

    interest = message.text #–ë–µ—Ä—ë–º –≤—ã–±—Ä–∞–Ω–Ω—ã–π –∏–Ω—Ç–µ—Ä–µ—Å
    #–°–æ–∑–¥–∞—ë–º —Å–ø–∏—Å–æ–∫ –∏–Ω—Ç–µ—Ä–µ—Å–æ–≤ (–µ—Å–ª–∏ –Ω–µ—Ç –ø—É—Å—Ç–æ–π —Å–ø–∏—Å–æ–∫)
    if "interests" not in user_data[user_id]:
        user_data[user_id]["interests"] = []
    #–ï—Å–ª–∏ –∏–Ω—Ç–µ—Ä–µ—Å –£–ñ–ï –≤—ã–±—Ä–∞–Ω, —Ç–æ —É–¥–∞–ª—è–µ–º –∏–∑ —Å–ø–∏—Å–∫–∞,
    if interest in user_data[user_id]["interests"]:
        user_data[user_id]["interests"].remove(interest)
        bot.send_message(message.chat.id, f"‚ùå –£–±—Ä–∞–Ω–æ: {interest}")
    else:#–ï—Å–ª–∏ –∏–Ω—Ç–µ—Ä–µ—Å –ù–ï –≤—ã–±—Ä–∞–Ω ,–¥–æ–±–∞–≤–ª—è–µ–º –≤ —Å–ø–∏—Å–æ–∫, –ø–∏—à–µ–º "–î–æ–±–∞–≤–ª–µ–Ω–æ:
        user_data[user_id]["interests"].append(interest)
        bot.send_message(message.chat.id, f"‚úÖ –î–æ–±–∞–≤–ª–µ–Ω–æ: {interest}")

    ints = user_data[user_id]["interests"]
    if ints:#–ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Ç–µ–∫—É—â–∏–π —Å–ø–∏—Å–æ–∫ —á–µ—Ä–µ–∑ –∑–∞–ø—è—Ç—É—é
        bot.send_message(message.chat.id, f"üìã –¢–≤–æ–∏ –∏–Ω—Ç–µ—Ä–µ—Å—ã: {', '.join(ints)}")

#–¥–µ–∫–æ—Ä–∞—Ç–æ—Ä –∫–Ω–æ–ø–∫–∏ –¥–∞–ª–µ–µ
@bot.message_handler(func=lambda m: m.text == "‚û°Ô∏è –î–∞–ª–µ–µ")
def handle_next(message):
    user_id = message.from_user.id #–ü–æ–ª—É—á–∞–µ–º ID –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
    #–ï—Å–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –Ω–µ—Ç –≤ –±–∞–∑–µ,–≤—ã—Ö–æ–¥–∏–º
    if user_id not in user_data:
        return

    step = user_data[user_id].get("step") #–Ω–∞ –∫–∞–∫–æ–º —à–∞–≥–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å

    # –ï—Å–ª–∏ —ç—Ç–∞–ø = –≤—ã–±–æ—Ä –∏–Ω—Ç–µ—Ä–µ—Å–æ–≤
    if step == "select_interests":
        user_data[user_id]["step"] = "select_subjects" #–ú–µ–Ω—è–µ–º —ç—Ç–∞–ø –Ω–∞ "select_subjects" (–≤—ã–±–æ—Ä –ø—Ä–µ–¥–º–µ—Ç–æ–≤)
        # #–ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Å–æ–æ–±—â–µ–Ω–∏–µ —Å –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–µ–π –∏ –∫–ª–∞–≤–∏–∞—Ç—É—Ä—É –ø—Ä–µ–¥–º–µ—Ç–æ–≤
        bot.send_message(message.chat.id,
                         "üìö *–í—ã–±–µ—Ä–∏ –ª—é–±–∏–º—ã–µ –ø—Ä–µ–¥–º–µ—Ç—ã:*\n(–º–æ–∂–Ω–æ –Ω–µ—Å–∫–æ–ª—å–∫–æ, –∑–∞—Ç–µ–º ¬´‚û°Ô∏è –î–∞–ª–µ–µ¬ª)",
                         parse_mode="Markdown", reply_markup=subjects_keyboard())

    elif step == "select_subjects":#–ï—Å–ª–∏ —ç—Ç–∞–ø = –≤—ã–±–æ—Ä –ø—Ä–µ–¥–º–µ—Ç–æ–≤
        user_data[user_id]["step"] = "enter_score" #–ú–µ–Ω—è–µ–º —ç—Ç–∞–ø –Ω–∞ "enter_score"
        remove = types.ReplyKeyboardRemove() #—É–±–∏—Ä–∞–µ–º –≤—Å–µ –∫–Ω–æ–ø–∫–∏
        #–ü—Ä–æ—Å–∏–º –≤–≤–µ—Å—Ç–∏ –±–∞–ª–ª—ã –ï–ì–≠
        bot.send_message(message.chat.id,
                         "üìä *–í–≤–µ–¥–∏ –ø—Ä–∏–º–µ—Ä–Ω—ã–µ –±–∞–ª–ª—ã –ï–ì–≠ (150-400):*\n–ù–∞–ø—Ä–∏–º–µ—Ä: 240",
                         parse_mode="Markdown", reply_markup=remove)

#–¥–µ–∫–æ—Ä–∞—Ç–æ—Ä –ø—Ä–µ–¥–º–µ—Ç–æ–≤
@bot.message_handler(func=lambda m: m.text in ["üìê –ú–∞—Ç–µ–º–∞—Ç–∏–∫–∞", "üìö –†—É—Å—Å–∫–∏–π", "üíª –ò–Ω—Ñ–æ—Ä–º–∞—Ç–∏–∫–∞",
                                               "üåç –û–±—â–µ—Å—Ç–≤–æ–∑–Ω–∞–Ω–∏–µ", "üß™ –•–∏–º–∏—è", "‚öõÔ∏è –§–∏–∑–∏–∫–∞",
                                               "üåé –ë–∏–æ–ª–æ–≥–∏—è", "üèõÔ∏è –ò—Å—Ç–æ—Ä–∏—è"])
def handle_subjects(message):

    user_id = message.from_user.id#–ü–æ–ª—É—á–∞–µ–º ID
    #–ï—Å–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ –≤ –±–∞–∑–µ –ò–õ–ò –Ω–µ –Ω–∞ —ç—Ç–∞–ø–µ –≤—ã–±–æ—Ä–∞ –∏–Ω—Ç–µ—Ä–µ—Å–æ–≤, –≤—ã—Ö–æ–¥–∏–º
    if user_id not in user_data or user_data[user_id].get("step") != "select_subjects":
        return

    subject = message.text #–ë–µ—Ä—ë–º –≤—ã–±—Ä–∞–Ω–Ω—ã–π –∏–Ω—Ç–µ—Ä–µ—Å
    # –ï—Å–ª–∏ –∫–ª—é—á–∞ "interests" –Ω–µ—Ç,—Å–æ–∑–¥–∞—ë–º –ø—É—Å—Ç–æ–π —Å–ø–∏—Å–æ–∫
    if "subjects" not in user_data[user_id]:
        user_data[user_id]["subjects"] = []

    if subject in user_data[user_id]["subjects"]:#–ï—Å–ª–∏ –∏–Ω—Ç–µ—Ä–µ—Å –£–ñ–ï –≤—ã–±—Ä–∞–Ω, —É–¥–∞–ª—è–µ–º
        user_data[user_id]["subjects"].remove(subject)
        bot.send_message(message.chat.id, f"‚ùå –£–±—Ä–∞–Ω–æ: {subject}")
    else:
        user_data[user_id]["subjects"].append(subject)#–ï—Å–ª–∏ –∏–Ω—Ç–µ—Ä–µ—Å –ù–ï –≤—ã–±—Ä–∞–Ω,–¥–æ–±–∞–≤–ª—è–µ–º
        bot.send_message(message.chat.id, f"‚úÖ –î–æ–±–∞–≤–ª–µ–Ω–æ: {subject}")
    #–ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Ç–µ–∫—É—â–∏–π —Å–ø–∏—Å–æ–∫ —á–µ—Ä–µ–∑ –∑–∞–ø—è—Ç—É—é
    subs = user_data[user_id]["subjects"]
    if subs:
        bot.send_message(message.chat.id, f"üìñ –¢–≤–æ–∏ –ø—Ä–µ–¥–º–µ—Ç—ã: {', '.join(subs)}")

##–¥–µ–∫–æ—Ä–∞—Ç–æ—Ä –±–∞–ª–ª–æ–≤
@bot.message_handler(func=lambda m: m.text and m.text.isdigit())
def handle_score(message):
    user_id = message.from_user.id #–ü–æ–ª—É—á–∞–µ–º ID
    #—Å–ª–∏ —ç—Ç–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –Ω–µ—Ç –≤ user_data ‚Äî –≤—ã—Ö–æ–¥–∏–º
    if user_id not in user_data or user_data[user_id].get("step") != "enter_score":
        return

    score = int(message.text) #–ü—Ä–µ–æ–±—Ä–∞–∑—É–µ–º —Ç–µ–∫—Å—Ç –≤ —á–∏—Å–ª–æ
    if 150 <= score <= 400: #–ü—Ä–æ–≤–µ—Ä—è–µ–º –¥–∏–∞–ø–∞–∑–æ–Ω –±–∞–ª–ª–æ–≤
        user_data[user_id]["score"] = score #–∑–∞–ø–∏—Å—ã–≤–∞–µ–º –±–∞–ª–ª—ã –≤ –∞–Ω–∫–µ—Ç—É

        # –ü–æ–¥–±–æ—Ä –≤—É–∑–æ–≤
        ints = user_data[user_id].get("interests", []) #–ü–æ–ª—É—á–∞–µ–º –≤—ã–±—Ä–∞–Ω–Ω—ã–µ –∏–Ω—Ç–µ—Ä–µ—Å—ã
        subs = user_data[user_id].get("subjects", []) #–ø—Ä–µ–¥–º–µ—Ç—ã

        universities = filter_universities(ints, subs, score) #–ø–æ–ª—É—á–∞–µ–º 3 —É–Ω–∏–≤–µ—Ä—Å–∏—Ç–µ—Ç–∞

        # –§–æ—Ä–º–∏—Ä—É–µ–º –æ—Ç–≤–µ—Ç
        text = f"üéâ *–†–µ–∑—É–ª—å—Ç–∞—Ç—ã –¥–ª—è {score} –±–∞–ª–ª–æ–≤:*\n\n"

        if universities:#–ï—Å–ª–∏ –≤—É–∑—ã –Ω–∞–π–¥–µ–Ω—ã
            for uni in universities: #–ü–µ—Ä–µ–±–∏—Ä–∞–µ–º –∫–∞–∂–¥—ã–π –≤—É–∑ –∏–∑ —Å–ø–∏—Å–∫–∞
                text += f"‚Ä¢ *{uni['name']}* ({uni['match']}%)\n" #–î–æ–±–∞–≤–ª—è–µ–º –≤ —Ç–µ–∫—Å—Ç: –Ω–∞–∑–≤–∞–Ω–∏–µ, –ø—Ä–æ—Ü–µ–Ω—Ç —Å–æ–≤–ø–∞–¥–µ–Ω–∏—è
                text += f"  {uni['description']}\n\n" # –æ–ø–∏—Å–∞–Ω–∏–µ
        else:#–ï—Å–ª–∏ –≤—É–∑–æ–≤ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ
            text += "üòî –ù–µ –Ω–∞–π–¥–µ–Ω–æ –ø–æ–¥—Ö–æ–¥—è—â–∏—Ö –≤—É–∑–æ–≤.\n"
            text += "–ü–æ–ø—Ä–æ–±—É–π —Ä–∞—Å—à–∏—Ä–∏—Ç—å –∏–Ω—Ç–µ—Ä–µ—Å—ã –∏–ª–∏ –ø—Ä–æ–π—Ç–∏ –ø—Ä–æ—Ñ—Ç–µ—Å—Ç.\n\n"

        text += "–î–ª—è –Ω–æ–≤–æ–≥–æ –ø–æ–∏—Å–∫–∞ –Ω–∞–∂–º–∏ /start"

        #–û—Ç–ø—Ä–∞–≤–ª—è–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç
        bot.send_message(message.chat.id, text,
                         parse_mode="Markdown", reply_markup=main_menu())
    else: #–ï—Å–ª–∏ –±–∞–ª–ª—ã –º–µ–Ω—å—à–µ 150 –∏–ª–∏ –±–æ–ª—å—à–µ 400 ‚Äî –æ—Ç–ø—Ä–∞–≤–ª—è–µ–º –æ—à–∏–±–∫—É
        bot.send_message(message.chat.id, "–í–≤–µ–¥–∏—Ç–µ —á–∏—Å–ª–æ –æ—Ç 150 –¥–æ 400")

#–¥–µ–∫–æ—Ä–∞—Ç–æ—Ä –∫–Ω–æ–ø–∫–∏ –û –±–æ—Ç–µ
@bot.message_handler(func=lambda m: m.text == "‚ÑπÔ∏è –û –±–æ—Ç–µ")
def about_bot(message):
    text = """
        ü§ñ *–û –ë–û–¢–ï*

        –ü—Ä–æ–µ–∫—Ç –ø–æ –∏–Ω—Ñ–æ—Ä–º–∞—Ç–∏–∫–µ, 10 –∫–ª–∞—Å—Å.
        –ü–æ–º–æ–≥–∞–µ—Ç –∞–±–∏—Ç—É—Ä–∏–µ–Ω—Ç–∞–º –≤—ã–±—Ä–∞—Ç—å –≤—É–∑ –≤ –ú–æ—Å–∫–≤–µ.
            """
    bot.send_message(message.chat.id, text, parse_mode="Markdown")

#–¥–µ–∫–æ—Ä–∞—Ç–æ—Ä –º–æ–∏ –¥–∞–Ω–Ω—ã–µ
@bot.message_handler(func=lambda m: m.text == "üìä –ú–æ–∏ –¥–∞–Ω–Ω—ã–µ")
def show_stats(message):
    user_id = message.from_user.id
    data = user_data.get(user_id, {})

    # –ü–æ–ª—É—á–∞–µ–º –¥–∞–Ω–Ω—ã–µ (–¥–∞–∂–µ –µ—Å–ª–∏ –∏—Ö –Ω–µ—Ç ‚Äî –ø–æ–¥—Å—Ç–∞–≤–ª—è–µ–º –∑–Ω–∞—á–µ–Ω–∏—è –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é)
    interests = data.get('interests', [])
    subjects = data.get('subjects', [])
    step = data.get('step', '–Ω–µ –Ω–∞—á–∞—Ç')
    score = data.get('score', '–Ω–µ —É–∫–∞–∑–∞–Ω—ã')
    prof_result = data.get('prof_result', [])

    # –ö—Ä–∞—Å–∏–≤–æ –æ—Ñ–æ—Ä–º–ª—è–µ–º –∏–Ω—Ç–µ—Ä–µ—Å—ã –∏ –ø—Ä–µ–¥–º–µ—Ç—ã
    interests_text = ', '.join(interests) if interests else '–Ω–µ –≤—ã–±—Ä–∞–Ω—ã'
    subjects_text = ', '.join(subjects) if subjects else '–Ω–µ –≤—ã–±—Ä–∞–Ω—ã'

    # –§–æ—Ä–º–∏—Ä—É–µ–º —Ç–µ–∫—Å—Ç
    text = f"""
üìä *–¢–í–û–ò –î–ê–ù–ù–´–ï*

‚Ä¢ –≠—Ç–∞–ø: {step}
‚Ä¢ –ò–Ω—Ç–µ—Ä–µ—Å—ã: {interests_text}
‚Ä¢ –ü—Ä–µ–¥–º–µ—Ç—ã: {subjects_text}
‚Ä¢ –ë–∞–ª–ª—ã –ï–ì–≠: {score}
    """

    if prof_result:
        text += "‚Ä¢ –ü—Ä–æ—Ñ—Ç–µ—Å—Ç: –ø—Ä–æ–π–¥–µ–Ω ‚úÖ\n"
        text += f"  –†–µ–∫–æ–º–µ–Ω–¥–æ–≤–∞–Ω–æ: {', '.join(prof_result)}\n"

    bot.send_message(message.chat.id, text, parse_mode="Markdown", reply_markup=main_menu())



'''@bot.message_handler(func=lambda m: m.text == "üìä –ú–æ–∏ –¥–∞–Ω–Ω—ã–µ")
def show_stats(message):
    user_id = message.from_user.id #–ü–æ–ª—É—á–∞–µ–º ID –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
    data = user_data.get(user_id, {})

    text = f"""
        üìä *–¢–í–û–Ø –°–¢–ê–¢–ò–°–¢–ò–ö–ê*

        ‚Ä¢ –≠—Ç–∞–ø: {data.get('step', '–Ω–µ –Ω–∞—á–∞—Ç')}
        ‚Ä¢ –ò–Ω—Ç–µ—Ä–µ—Å—ã: {len(data.get('interests', []))}
        ‚Ä¢ –ü—Ä–µ–¥–º–µ—Ç—ã: {len(data.get('subjects', []))}
        ‚Ä¢ –ë–∞–ª–ª—ã: {data.get('score', '–Ω–µ —É–∫–∞–∑–∞–Ω—ã')}
        """

    if data.get("prof_result"):
        text += "‚Ä¢ –ü—Ä–æ—Ñ—Ç–µ—Å—Ç: –ø—Ä–æ–π–¥–µ–Ω ‚úÖ\n"

    bot.send_message(message.chat.id, text, parse_mode="Markdown")'''

#–¥–µ–∫–æ—Ä–∞—Ç–æ—Ä –≤—Å–µ—Ö –¥—Ä—É–≥–∏—Ö —Å–ª—É—á–∞–µ–≤
@bot.message_handler(func=lambda m: True)
def handle_other(message):
    bot.send_message(message.chat.id,
                     "–ò—Å–ø–æ–ª—å–∑—É–π –∫–Ω–æ–ø–∫–∏ –º–µ–Ω—é üëÜ\n/start - –Ω–∞—á–∞—Ç—å –∑–∞–Ω–æ–≤–æ",
                     reply_markup=main_menu())

#–ó–ê–ü–£–°–ö –ë–û–¢–ê
print("=" * 60)
print("‚úÖ –ë–û–¢ –ó–ê–ü–£–©–ï–ù! –ù–∞–ø–∏—à–∏—Ç–µ /start –≤ Telegram")
print("=" * 60)

bot.polling(none_stop=True)
